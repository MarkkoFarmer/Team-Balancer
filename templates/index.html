<!-- index.html -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Team Balancer</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; margin: 0; }
        .container { display: flex; flex-wrap: wrap; justify-content: center; max-width: 100%; }
        .form-section { margin: 10px; flex: 1 1 45%; min-width: 300px; }
        .form-section h2 { margin-top: 0; }
        .player-entry { display: flex; align-items: center; margin-bottom: 5px; }
        .player-entry select, .player-entry input { margin-right: 10px; flex: 1; }
        .teams { display: flex; justify-content: space-around; margin-top: 20px; flex-wrap: wrap; }
        .team { border: 1px solid #ccc; padding: 10px; min-width: 200px; margin: 10px; }
        .error { color: red; font-weight: bold; }
    </style>
    <script>
        async function updateSkill(type, index) {
            const name = document.getElementById(`${type}_name_${index}`).value;
            if (!name) return;
            const res = await fetch(`/get_skill/${type === 'player' ? 'players' : 'goalkeepers'}/${encodeURIComponent(name)}`);
            const data = await res.json();
            const skillInput = document.getElementById(`${type}_skill_${index}`);
            if (data.skill !== undefined) {
                skillInput.value = data.skill;
            }
        }
    </script>
</head>
<body>
    <h1>Team Balancer</h1>

    <a href="/add_player">Add Players</a> | <a href="/add_goalkeeper">Add Goalkeepers</a>

    <form method="POST">
        {% if error %}<p class="error">{{ error }}</p>{% endif %}

        <div class="container">
            <div class="form-section">
                <h2>Select 20 Players</h2>
                {% for i in range(20) %}
                <div class="player-entry">
                    <select name="player_name" id="player_name_{{ i }}" onchange="updateSkill('player', {{ i }})">
                        <option value="">-- Select Player --</option>
                        {% for name in players %}
                        <option value="{{ name }}" {% if selected_players[i] == name %}selected{% endif %}>{{ name }}</option>
                        {% endfor %}
                    </select>
                    <input type="text" name="player_skill" id="player_skill_{{ i }}" value="{{ selected_skills[i] if selected_skills|length > i else '' }}" pattern="\d+(\.|,)?\d{0,2}" placeholder="Skill">
                </div>
                {% endfor %}
            </div>

            <div class="form-section">
                <h2>Select 2 Goalkeepers</h2>
                {% for i in range(2) %}
                <div class="player-entry">
                    <select name="gk_name" id="gk_name_{{ i }}" onchange="updateSkill('gk', {{ i }})">
                        <option value="">-- Select Goalkeeper --</option>
                        {% for name in goalkeepers %}
                        <option value="{{ name }}" {% if selected_gks[i] == name %}selected{% endif %}>{{ name }}</option>
                        {% endfor %}
                    </select>
                    <input type="text" name="gk_skill" id="gk_skill_{{ i }}" value="{{ selected_gk_skills[i] if selected_gk_skills|length > i else '' }}" pattern="\d+(\.|,)?\d{0,2}" placeholder="Skill">
                </div>
                {% endfor %}
            </div>
        </div>

        <div style="text-align: center; margin-top: 20px;">
            <button type="submit">Generate Teams</button>
        </div>
    </form>

    <div class="teams">
        <div class="team">
            <h2>Team 1</h2>
            <ul>
                {% for name, skill in team1 %}
                <li>{{ name }} - {{ skill }}</li>
                {% endfor %}
            </ul>
        </div>
        <div class="team">
            <h2>Team 2</h2>
            <ul>
                {% for name, skill in team2 %}
                <li>{{ name }} - {{ skill }}</li>
                {% endfor %}
            </ul>
        </div>
    </div>
</body>
</html>
